# Тестування середнього навантаження

Тест середнього навантаження оцінює, як система працює під типовим навантаженням. Типове навантаження може відповідати звичайному робочому дню у продакшені або середньостатистичному моменту роботи системи.

імітують кількість одночасних користувачів та запитів за секунду, які відповідають середній поведінці у продакшен-середовищі.

Зазвичай цей тип тестів поступово збільшує навантаження або кількість VUs та підтримує його протягом певного часу.

В залежності від особливостей системи, тест може завершитися раптово або мати короткий період зниження навантаження.

## Огляд тесту середнього навантаження

У деяких джерелах цей тест також може називатися "тестом робочого дня" або "тестом об'єму".

### Коли запускати тест середнього навантаження

Тестування середнього навантаження допомагає зрозуміти, чи відповідає система своїм продуктивним показникам у типовий день (звичайне навантаження). Типовий день означає, що середня кількість користувачів одночасно взаємодіє з додатком, виконуючи звичайні завдання.

Тест середнього навантаження слід запускати для:

- Оцінки продуктивності системи під типовим навантаженням.
- Виявлення ранніх ознак деградації під час періоду нарощування навантаження або повного навантаження.
- Переконання, що система залишається у відповідності до продуктивних стандартів після змін у коді або інфраструктурі.

## Основні аспекти тестування середнього навантаження

### Визначте кількість користувачів та типову пропускну здатність системи

Для цього використовуйте APM або аналітичні інструменти, які надають інформацію з продакшену. Якщо доступу до таких інструментів немає, бізнес повинен надати ці оцінки.

### Поступово збільшуйте навантаження до середнього рівня

Це означає використання періоду нарощування навантаження (ramp-up).
Зазвичай цей період займає від 5% до 15% загальної тривалості тесту. Ramp-up має важливе значення, оскільки:

- Дає системі час на "прогрів" або авто-масштабування для обробки трафіку.
- Дозволяє порівняти час відгуку між низьким та середнім рівнем навантаження.
- Якщо ви використовуєте хмарний сервіс тестування, ramp-up допомагає автоматизованим попередженням зрозуміти очікувану поведінку системи.

### Підтримуйте середнє навантаження довше, ніж період ramp-up

Рекомендується, щоб цей період тривав щонайменше у п’ять разів довше, ніж ramp-up, щоб оцінити тренд продуктивності на значному часовому проміжку.

### Додайте період ramp-down

Ramp-down — це коли активність віртуальних користувачів поступово зменшується. Він зазвичай триває стільки ж, як ramp-up, або трохи менше.

---

## Тестування середнього навантаження в k6

> **Примітка:** Якщо ви вперше запускаєте тести навантаження, рекомендується починати з малого або налаштувати повільний ramp-up. Ваша система та інфраструктура можуть бути не такими стабільними, як вам здається. Багато користувачів запускали тестування навантаження, яке швидко "ламало" їх додатки або staging-середовища.

Мета тесту середнього навантаження — змоделювати середню кількість активності у типовий день у продакшені. Сценарій тесту виконується за такою схемою:

1. Поступове збільшення активності скрипта до цільової кількості користувачів та пропускної здатності.
2. Підтримання цього навантаження певний час.
3. Залежно від тесту, завершення виконання або поступове зменшення навантаження (ramp-down).

Налаштування навантаження в об'єкті `options`:

```javascript
import http from "k6/http";
import { sleep } from "k6";

export const options = {
  // Основні налаштування для тесту середнього навантаження
  stages: [
    { duration: "5m", target: 100 }, // нарощування трафіку від 1 до 100 користувачів за 5 хвилин
    { duration: "30m", target: 100 }, // підтримання 100 користувачів протягом 30 хвилин
    { duration: "5m", target: 0 }, // зниження навантаження до 0 користувачів
  ],
};

export default () => {
  const urlRes = http.get("https://quickpizza.grafana.com");
  sleep(1);
  // ДОДАТКОВІ КРОКИ
  // Тут можна додати більше кроків або складніший скрипт
  // Крок 1
  // Крок 2
  // тощо
};
```

Цей скрипт містить лише один запит (відкриття веб-сторінки). У вашому тесті, ймовірно, буде більше кроків. Для більш складних тестів, які використовують групи, перевірки (checks),
порогові значення (thresholds) та допоміжні функції, зверніться до розділу **Приклади**.

## Аналіз результатів

Перші результати тесту середнього навантаження з’являються під час ramp-up періоду. У цей момент можна виявити, чи погіршується час відгуку зі збільшенням навантаження. Деякі системи можуть навіть відмовити під час ramp-up.

Тест перевіряє, чи залишається продуктивність та споживання ресурсів стабільними протягом повного навантаження, оскільки деякі системи можуть демонструвати нестабільну поведінку у цей період.

Якщо система працює добре під типовим навантаженням, наступним кроком може бути перевірка її поведінки у умовах підвищеного навантаження. Деякі з таких тестів називають **стрес-тестами**.
